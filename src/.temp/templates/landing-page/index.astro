---
import "@/styles/index.scss";
import type { Page } from "@/types/clientWebsite";
import { flattenProps } from "@/utils/flattenProps";
import { getPageContent } from "@/lib/getPageContent";
import Layout from "@/components/system/Layout.tsx";
import DynamicIsland from "@/components/system/DynamicIsland";
import { getComponentByPath } from "@/utils/getComponentByPath";
import globalComponents from "@/data/global.json";

// Real
// const page = getPageContent({
//   locals: Astro.locals,
//   params: {
// 		path: '/'
// 	}
// });

// Mock
const page: Page = {
  id: "7ab5952b-29ae-40c5-8734-3c8d94cc1460",
  slug: "nueva-pagina-1",
  type: "landing-page",
  title: "Nueva pÃ¡gina",
  author: {
    id: "",
    url: "",
    name: "",
  },
  noindex: false,
  sitemap: {
    priority: 0.5,
    changefreq: "monthly",
  },
  language: "es",
  nofollow: false,
  canonical: null,
  components: [
    {
      name: "hero-1-horizontal",
      custom_attrs: {
        title: {
          type: "string",
          value: "Hero 1 Horizontal",
        },
        description: {
          type: "string",
          value:
            "A hero section with a horizontal layout, featuring a title, description, and an optional left section component.",
        },
        color_background: {
          type: "color",
          value: "var(--color-background)",
        },
        image_hero_right_href: {
          type: "img",
          value:
            "https://cdn.dribbble.com/userupload/17997198/file/original-0b76b434fff5a0d73ace858d1eed107d.png?resize=1024x768&vertical=center",
        },
        hero_left_section_component: {
          type: "component",
          value: null,
        },
      },
      atomic_hierarchy: "template",
    },
  ],
  meta_title: "",
  open_graph: {
    og_type: "website",
    og_image: {
      alt: "",
      src: "",
      width: 0,
      height: 0,
      srcset: [],
      formats: ["webp"],
    },
    og_title: "",
    twitter_card: "summary",
    og_description: "",
  },
  schema_org: {},
  word_count: 0,
  breadcrumbs: [],
  modified_at: "2025-11-18T16:05:15.907Z",
  published_at: "2025-11-18T16:05:15.906Z",
  reading_time: 0,
  robots_extra: "",
  keyword_focus: [],
  redirect_from: [],
  featured_image: {
    alt: "",
    src: "",
    width: 0,
    height: 0,
    srcset: [],
    formats: ["webp"],
  },
  meta_description: "",
  hreflang_alternates: [],
  content_text_summary: "",
};

const items = page.components.map((component) => {
  const dir = (component.atomic_hierarchy as string).endsWith('s') ? component.atomic_hierarchy : `${component.atomic_hierarchy}s`;
  const componentPath = `${dir}/${component.name}`;
  const props = flattenProps(component.custom_attrs || {});
  return { componentPath, props };
});
---

<Layout page={page}>
  <div class="page-sandbox">
    <>
      {/* Global Header */}
      {globalComponents?.header && (
        await getComponentByPath(
          `${(globalComponents.header as any).atomic_hierarchy}s/${(globalComponents.header as any).name}`,
          flattenProps(((globalComponents.header as any).custom_attrs || {}) as Record<string, any>)
        )
      )}
      {items.map(async ({ componentPath, props }) => (
        await getComponentByPath(componentPath as string, props as Record<string, any>)
      ))}
      {/* Global Footer */}
      {globalComponents?.footer && (
        await getComponentByPath(
          `${(globalComponents.footer as any).atomic_hierarchy}s/${(globalComponents.footer as any).name}`,
          flattenProps(((globalComponents.footer as any).custom_attrs || {}) as Record<string, any>)
        )
      )}
    </>
  </div>
</Layout>
