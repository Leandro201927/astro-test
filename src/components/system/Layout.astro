---
import type { Page } from "@/types/clientWebsite";

interface Props {
  page: Page;
}

const { page } = Astro.props;

const metaTitle = page.meta_title || page.title;
const metaDescription = page.meta_description || "";
const canonical = page.canonical || null;
const robots = `${page.noindex ? "noindex" : "index"}, ${page.nofollow ? "nofollow" : "follow"}${page.robots_extra ? ", " + page.robots_extra : ""}`;

const og = page.open_graph || {};
const ogImage = og.og_image || {};
const ogUrl = og.og_url || canonical || undefined;

const alternates = page.hreflang_alternates || [];
---

<html lang={page.language}>
  <head>
    <title>{metaTitle}</title>
    <meta charset="UTF-8" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={metaDescription} />
    <meta name="robots" content={robots} />
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" />
    {canonical && <link rel="canonical" href={canonical} />}
    {alternates.map((alt: any) => (
      <link rel="alternate" hreflang={alt.lang} href={alt.url} />
    ))}
    <meta property="og:type" content={og.og_type || "website"} />
    <meta property="og:title" content={og.og_title || metaTitle} />
    <meta property="og:description" content={og.og_description || metaDescription} />
    {og.og_site_name && <meta property="og:site_name" content={og.og_site_name} />}
    {ogUrl && <meta property="og:url" content={ogUrl} />}
    {og.og_locale && <meta property="og:locale" content={og.og_locale} />}
    {ogImage.src && <meta property="og:image" content={ogImage.src} />}
    {typeof ogImage.width === 'number' && ogImage.width > 0 && (
      <meta property="og:image:width" content={String(ogImage.width)} />
    )}
    {typeof ogImage.height === 'number' && ogImage.height > 0 && (
      <meta property="og:image:height" content={String(ogImage.height)} />
    )}
    <meta name="twitter:card" content={og.twitter_card || "summary"} />
    <meta name="twitter:title" content={og.twitter_title || og.og_title || metaTitle} />
    <meta name="twitter:description" content={og.twitter_description || og.og_description || metaDescription} />
    {(og.twitter_image || ogImage.src) && <meta name="twitter:image" content={(og.twitter_image || ogImage.src) as string} />}
    {Object.keys(page.schema_org || {}).length > 0 && (
      <script type="application/ld+json" set:html={JSON.stringify(page.schema_org)} />
    )}
  </head>
  <body>
    <slot />
  </body>
</html>
